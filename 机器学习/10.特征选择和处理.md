# ç‰¹å¾å¤„ç†

## å“‘å˜é‡

å“‘å˜é‡å°±æ˜¯å°±æ˜¯ä¸€ç§è™šæ‹Ÿå˜é‡ï¼Œå°±æ˜¯æŠŠæŸäº›å˜é‡è½¬æ¢ä¸ºäºŒå€¼å˜é‡ï¼Œpandasä¸­çš„`get_dummies`å¯ä»¥å®ç°ï¼š

```python
import pandas as pd
df = pd.DataFrame(
    {
        "col1":[1,2,3],
        "col2":["a","b", "c"],
        "col3":["A","A","B"]
    }
)
pd.get_dummies(df)
# é»˜è®¤åªå¯¹å­—ç¬¦åˆ—æ“ä½œ, å°†æ•°å€¼è½¬ä¸ºstråå°±å¯ä»¥åº”ç”¨äº†
df["col1"] = df['col1'].astype(str)
pd.get_dummies(df)
```

<img src="https://51catgithubio.oss-cn-beijing.aliyuncs.com/image-20240628103241073.png" alt="image-20240628103241073" style="zoom:67%;" />

## è£…ç®±

åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œä¸åŒçš„ç®—æ³•å»ºç«‹çš„æ¨¡å‹ä¼šæœ‰å¾ˆå¤§çš„å·®åˆ«ã€‚å³ä¾¿æ˜¯åœ¨åŒä¸€ä¸ªæ•°æ®é›†ä¸­ï¼Œè¿™ç§å·®åˆ«ä¹Ÿä¼šå­˜åœ¨ã€‚è¿™æ˜¯ç”±äºç®—æ³•çš„å·¥ä½œåŸç†ä¸åŒæ‰€å¯¼è‡´çš„ï¼Œå¦‚KNNå’ŒMLP

```python
import numpy as np
import matplotlib.pyplot as plt
from sklearn.neural_network import MLPRegressor
from sklearn.neighbors import KNeighborsRegressor

rnd = np.random.RandomState(38)
x = rnd.uniform(-5,5, size = 50)
X = X.reshape(-1,1)
y = ((x*2+2 + rnd.normal(size = len(x))))/2

line = np.linspace(-5,5, 1000, endpoint=False).reshape(-1, 1)
mlp = MLPRegressor().fit(X,y)
knn = KNeighborsRegressor().fit(X,y)

plt.plot(X, y,'o')
plt.plot(line, mlp.predict(line), label = "MLP")
plt.plot(line, knn.predict(line), label = "KNN")
plt.legend()
```

![image-20240628151419050](https://51catgithubio.oss-cn-beijing.aliyuncs.com/image-20240628151419050.png)

MLPäº§ç”Ÿçš„å›å½’çº¿éå¸¸æ¥è¿‘çº¿æ€§æ¨¡å‹çš„ç»“æœï¼Œè€ŒKNNåˆ™ç›¸å¯¹æ›´å¤æ‚ä¸€äº›ï¼Œå®ƒè¯•å›¾è¦†ç›–æ›´å¤šçš„æ•°æ®ç‚¹ã€‚

ä¸‹é¢å¯¹æ•°æ®è¿›è¡Œç¦»æ•£åŒ–å¤„ç†ï¼š

1. æŒ‡å®šå®¹å™¨ï¼Œæˆ‘ä»¬æ•°æ®ç”Ÿæˆçš„èŒƒå›´æ˜¯-5ï¼Œåˆ°5ï¼Œæ‰€ä»¥å®¹å™¨èŒƒå›´ä¹Ÿæ˜¯
2. æŒ‡å®šå®¹å™¨ä¸ªæ•°
3. åˆ†ç®±ï¼ˆå°†æ•°æ®è½¬æ¢ä¸ºæ‰€åœ¨çš„åŒºé—´indexï¼‰

```python
# æ„å»º
bins = np.linspace(-5,5, 11) #array([-5., -4., -3., -2., -1.,  0.,  1.,  2.,  3.,  4.,  5.])
# åˆ†ç®±, ä½¿ç”¨np.digitizeï¼Œå¯ä»¥è¾“å‡ºç»™å®šæ•°ç»„åœ¨ç»™å®šèŒƒå›´å†…çš„index
#Signature: np.digitize(x, bins, right=False)
#Docstring:
#Return the indices of the bins to which each value in input array belongs.
target_bin = np.digitize(X, bins=bins)
target_bin[0:3]
# out
#array([[ 4], -1.1522688å±äº -2., -1. å±äºç¬¬å››ä¸ªåŒºé—´
#       [9],   3.59707847å±äº3.,  4 ç¬¬9ä¸ªåŒºé—´
#       [ 10]], dtype=int64)  4.4419963 æœ€åä¸€ä¸ªåŒºé—´
```

scikit-learnçš„ç‹¬çƒ­ç¼–ç OneHotEncoderã€‚OneHotEncoderå’Œpandasçš„get_dummiesåŠŸèƒ½åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯OneHotEncoderç›®å‰åªèƒ½ç”¨äºæ•´å‹æ•°å€¼çš„ç±»å‹å˜é‡

```python
from sklearn.preprocessing import OneHotEncoder
one = OneHotEncoder(sparse=False).fit(target_bin)
X_in_bin = one.transform(target_bin)
```

åˆ—çš„æ„æ€å°±æ˜¯æ¯ä¸ªåŒºé—´(-5,-4), (-4,-3)....(4, 5)ï¼Œå¯¹åº”çš„binçš„ç¼–å·

è¡Œå°±æ˜¯æˆ‘ä»¬ç”Ÿæˆçš„Xçš„æ¯ä¸ªå€¼

ç›¸å½“äºæˆ‘ä»¬æŠŠåŸå…ˆæ•°æ®é›†ä¸­çš„è¿ç»­ç‰¹å¾è½¬åŒ–æˆäº†ç±»åˆ«ç‰¹å¾

![image-20240628152608453](https://51catgithubio.oss-cn-beijing.aliyuncs.com/image-20240628152608453.png)



é‡æ–°è¿›è¡ŒMLPå’ŒKNN

```python
mlp = MLPRegressor().fit(X_in_bin,y)
knn = KNeighborsRegressor().fit(X_in_bin,y)

line = np.linspace(-5,5, 1000, endpoint=False).reshape(-1, 1)
new_line = one.transform(np.digitize(line, bins))

plt.plot(X, y,'o')
plt.plot(line, mlp.predict(new_line), label = "MLP")
plt.plot(line, knn.predict(new_line), label = "KNN")
plt.legend()
```

![image-20240628153640127](https://51catgithubio.oss-cn-beijing.aliyuncs.com/image-20240628153640127.png)

MLPæ¨¡å‹å’ŒKNNæ¨¡å‹å˜å¾—æ›´ç›¸ä¼¼äº†ï¼Œå°¤å…¶åœ¨x>0çš„éƒ¨åˆ†ï¼Œä¸¤ä¸ªæ¨¡å‹å‡ ä¹å®Œå…¨é‡åˆã€‚MLPçš„å›å½’æ¨¡å‹å˜å¾—æ›´å¤æ‚ï¼Œè€ŒKNNçš„æ¨¡å‹å˜å¾—æ›´ç®€å•ã€‚æ‰€ä»¥è¿™æ˜¯å¯¹æ ·æœ¬ç‰¹å¾è¿›è¡Œè£…ç®±çš„ä¸€ä¸ªå¥½å¤„ï¼šå®ƒå¯ä»¥çº æ­£æ¨¡å‹è¿‡æ‹Ÿåˆæˆ–è€…æ¬ æ‹Ÿåˆçš„é—®é¢˜ã€‚å°¤å…¶æ˜¯å½“é’ˆå¯¹å¤§è§„æ¨¡é«˜ç»´åº¦çš„æ•°æ®é›†ä½¿ç”¨çº¿æ€§æ¨¡å‹çš„æ—¶å€™ï¼Œè£…ç®±å¤„ç†å¯ä»¥å¤§å¹…æé«˜çº¿æ€§æ¨¡å‹çš„é¢„æµ‹å‡†ç¡®ç‡

## å‡ç»´

æ•°æ®é›†çš„ç‰¹å¾ä¸è¶³çš„æƒ…å†µã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦å¯¹æ•°æ®é›†çš„ç‰¹å¾è¿›è¡Œæ‰©å……ã€‚è¿™é‡Œæˆ‘ä»¬ä»‹ç»ä¸¤ç§åœ¨ç»Ÿè®¡å»ºæ¨¡ä¸­å¸¸ç”¨çš„æ–¹æ³•â€”â€”äº¤äº’å¼ç‰¹å¾ï¼ˆInteraction Featuresï¼‰å’Œå¤šé¡¹å¼ç‰¹å¾ï¼ˆPolynomial Featuresï¼‰ï¼Œäº¤äº’å¼ç‰¹å¾æ˜¯åœ¨åŸå§‹æ•°æ®ç‰¹å¾ä¸­æ·»åŠ äº¤äº’é¡¹ï¼Œä½¿ç‰¹å¾æ•°é‡å¢åŠ ã€‚åœ¨Pythonä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Numpyçš„hstackå‡½æ•°æ¥å¯¹æ•°æ®é›†æ·»åŠ äº¤äº’é¡¹

```python
# np.hstack å‡½æ•°æ˜¯ NumPy åº“ä¸­ç”¨äºæ°´å¹³ï¼ˆæ¨ªå‘ï¼‰å †å æ•°ç»„çš„å‡½æ•°ã€‚ä»¥ä¸‹æ˜¯æ ¹æ®æä¾›çš„æ–‡æ¡£å­—ç¬¦ä¸²å¯¹è¯¥å‡½æ•°çš„ä¸­æ–‡è§£é‡Šå’Œä½¿ç”¨ç¤ºä¾‹ï¼š
#æ‰‹å·¥ç”Ÿæˆä¸¤ä¸ªæ•°ç»„
array_1 = [1,2,3,4,5]
array_2 = [6,7,8,9,0]
#ä½¿ç”¨hstackå°†ä¸¤ä¸ªæ•°ç»„è¿›è¡Œå †å 
array_3 = np.hstack((array_1, array_2))
#æ‰“å°ç»“æœ
print('å°†æ•°ç»„2æ·»åŠ åˆ°æ•°æ®1ä¸­åå¾—åˆ°:{}'.format(array_3)) # å°†æ•°ç»„2æ·»åŠ åˆ°æ•°æ®1ä¸­åå¾—åˆ°:[1 2 3 4 5 6 7 8 9 0]
```

ä»ç»“æœä¸­çœ‹åˆ°ï¼ŒåŸæ¥ä¸¤ä¸ª5ç»´æ•°ç»„è¢«å †æ”¾åˆ°ä¸€èµ·ï¼Œå½¢æˆäº†ä¸€ä¸ªæ–°çš„åç»´æ•°ç»„ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä½¿array_1å’Œarray_2äº§ç”Ÿäº†äº¤äº’ã€‚å‡å¦‚array_1å’Œarray_2åˆ†åˆ«ä»£è¡¨ä¸¤ä¸ªæ•°æ®ç‚¹çš„ç‰¹å¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”Ÿæˆçš„array_3å°±æ˜¯å®ƒä»¬çš„äº¤äº’ç‰¹å¾

ä¾‹å¦‚å°†X.X_in_binåŠ å…¥

```python
X_multi = np.hstack([X_in_bin, X*X_in_bin])
X_multi[0:4]
```

![image-20240628155551632](https://51catgithubio.oss-cn-beijing.aliyuncs.com/image-20240628155551632.png)

# ç‰¹å¾é€‰æ‹©

## å•ä¸€å˜é‡æ³•è¿›è¡Œç‰¹å¾é€‰æ‹©

æœ€ç®€å•çš„ä¸¤ç§æ˜¯SelectPercentileå’ŒSelectKBestï¼Œå…¶ä¸­SelectPercentileæ˜¯è‡ªåŠ¨é€‰æ‹©åŸå§‹ç‰¹å¾çš„ç™¾åˆ†æ¯”ï¼Œä¾‹å¦‚åŸå§‹æ•°æ®çš„ç‰¹å¾æ•°æ˜¯200ä¸ªï¼Œé‚£ä¹ˆSelectPercentileçš„pecentileå‚æ•°è®¾ç½®ä¸º50ï¼Œå°±ä¼šé€‰æ‹©100ä¸ªåŸå§‹ç‰¹å¾ä¸­çš„50%ï¼Œå³100ä¸ªï¼Œè€ŒSelectKBestæ˜¯è‡ªåŠ¨é€‰æ‹©*K*ä¸ªæœ€é‡è¦çš„ç‰¹å¾

### SelectPercentile

å¯¼å…¥ä¸‹é¢çš„åŒ…ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†éƒ½æ˜¯åŸºäºè¿™äº›

```python
from sklearn.feature_selection import SelectPercentile, SelectFromModel, RFE
from sklearn.linear_model import Ridge
from sklearn.ensemble import RandomForestClassifier
from sklearn.neural_network import MLPClassifier
from sklearn.preprocessing import StandardScaler
from sklearn.datasets import load_wine
from sklearn.model_selection import train_test_split
import pandas as pd
import numpy as np
```

ä½¿ç”¨é…’çš„æ•°æ®é›†æ¥éªŒè¯

```python
data = load_wine()
X = data.data
y = data.target
f_name = data.feature_names
X_train, X_test, y_train, y_test = train_test_split(X, y)

# ä¸è¿›è¡Œç‰¹å¾é€‰æ‹©
# é¦–å…ˆæ ‡å‡†åŒ–æ•°æ®
ss = StandardScaler()
ss.fit(X_train)
X_train_scale = ss.transform(X_train)
X_test_scale = ss.transform(X_test)

mlpc = MLPClassifier(random_state=60, hidden_layer_sizes = (50,50))
mlpc.fit(X_train_scale, y_train)
mlpc.score(X_test_scale, y_test)
# æ¨¡å‹çš„å¾—åˆ†æ˜¯ 0.97777

# ä¸‹é¢åšä¸€ä¸‹å•ä¸€å˜é‡æ³•çš„ç‰¹å¾é€‰æ‹©
select = SelectPercentile(percentile=50)
select.fit(X_train_scale, y_train)
X_train_select = select.transform(X_train_scale)
print(X_train_select.shape) # 
np.array(f_name)[select.get_support()]
```

![image-20240701155024331](https://51catgithubio.oss-cn-beijing.aliyuncs.com/image-20240701155024331.png)

æœ€åä¿ç•™äº†6ä¸ªç‰¹å¾, æµ‹è¯•ä¸€ä¸‹è¿™åªç”¨è¿™å…­ä¸ªç‰¹å¾å¯¹æ¨¡å‹çš„å½±å“

```python
mlpc = MLPClassifier(random_state=60, hidden_layer_sizes = (50,50))
mlpc.fit(X_train_select, y_train)
mlpc.score(select.transform(X_test_scale), y_test) 
# out
# 1.0 æ¨¡å‹æ‹Ÿåˆä¸º1ï¼Œè¿™ä¸ªå¯èƒ½æ˜¯ç”±äºæ•°æ®é‡å¤ªå°äº†...,ä¹Ÿèƒ½è®¤ä¸ºæ¨¡å‹çš„é¢„æµ‹èƒ½åŠ›æå‡äº†...
# SelectKBestç»“æœä¸€è‡´
select = SelectKBest(k=6)
select.fit(X_train_scale, y_train)
X_train_select = select.transform(X_train_scale)
print(X_train_select.shape)
np.array(f_name)[select.get_support()]
```

### SelectFromModel

åŸºäºä¸€ä¸ªæœ‰ç›‘ç£æ¨¡å‹çš„é€‰æ‹©ï¼Œç›´æ¥ä»è¿™ä¸ªå±æ€§ä¸­æŠ½å–ç‰¹å¾çš„é‡è¦æ€§ã€‚å½“ç„¶é™¤äº†éšæœºæ£®æ—ä¹‹å¤–ï¼Œå…¶ä»–ç®—æ³•ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¾‹å¦‚ä½¿ç”¨L1æ­£åˆ™åŒ–çš„çº¿æ€§æ¨¡å‹ï¼Œå®ƒä»¬å¯ä»¥å¯¹æ•°æ®ç©ºé—´çš„ç¨€ç–ç³»æ•°è¿›è¡Œå­¦ä¹ ï¼Œä»è€Œå¯ä»¥å½“ä½œç‰¹å¾é‡è¦æ€§æ¥æŠ½å–ã€‚åŸæœ¬è¿™ä¸ªç³»æ•°æ˜¯çº¿æ€§æ¨¡å‹ç”¨æ¥ä¸ºè‡ªå·±å»ºæ¨¡çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å€ŸåŠ©å®ƒæ¥å¸®åŠ©å…¶ä»–æ¨¡å‹è¿›è¡Œæ•°æ®é¢„å¤„ç†ï¼Œ

éœ€è¦æ¨¡å‹ä¸­æœ‰ ``feature_importances_`` or `coef_`å±æ€§ï¼Œç”¨éšæœºæ£®æ—å’Œå²­å›å½’ï¼ˆL1ï¼‰æ¥è¿›è¡Œä¸€ä¸‹å˜é‡é€‰æ‹©

```python
sfm = SelectFromModel(
    RandomForestClassifier(n_estimators=100, random_state=30),
    threshold='median' # æ¯ä¸ªå˜é‡çš„feature_importances_ é«˜äºmedianè¢«ä¿ç•™ï¼Œåä¹‹å€èˆå¼ƒ
    )
sfm.fit(X_train_scale, y_train)
X_train_sfm = sfm.transform(X_train_scale)
print(X_train_sfm.shape)
np.array(f_name)[sfm.get_support()]
```

![image-20240701155817563](https://51catgithubio.oss-cn-beijing.aliyuncs.com/image-20240701155817563.png)

ä¸å•ä¸€å˜é‡çš„æ–¹æ³•åŸºæœ¬ä¸€è‡´ï¼Œå¤šäº†ä¸€ä¸ªç‰¹å¾ï¼Œæ˜¯ä¸æ˜¯äºŒè€…å¯ä»¥å–äº¤é›†ï¼ŒğŸ¤”...

```python
sfr = SelectFromModel(
        Ridge(alpha=1),
    threshold='mean'
        
    )
sfm.fit(X_train_scale, y_train)
X_train_sfm = sfm.transform(X_train_scale)
print(X_train_sfm.shape)
np.array(f_name)[sfm.get_support()]
# ç»“æœå’Œéšæœºæ£®æ—æ˜¯ä¸€è‡´çš„
```

### è¿­ä»£å¼é€‰æ‹©

è¿­ä»£å¼ç‰¹å¾é€‰æ‹©æ˜¯åŸºäºè‹¥å¹²ä¸ªæ¨¡å‹è¿›è¡Œç‰¹å¾é€‰æ‹©ã€‚åœ¨scikit-learnä¸­ï¼Œæœ‰ä¸€ä¸ªç§°ä¸ºé€’å½’ç‰¹å¾å‰”é™¤æ³•ï¼ˆRecurise Feature Elimination, RFEï¼‰çš„åŠŸèƒ½å°±æ˜¯é€šè¿‡è¿™ç§æ–¹å¼æ¥è¿›è¡Œç‰¹å¾é€‰æ‹©çš„ã€‚åœ¨æœ€å¼€å§‹ï¼ŒRFEä¼šç”¨æŸä¸ªæ¨¡å‹å¯¹ç‰¹å¾è¿›è¡Œé€‰æ‹©ï¼Œä¹‹åå†å»ºç«‹ä¸¤ä¸ªæ¨¡å‹ï¼Œå…¶ä¸­ä¸€ä¸ªå¯¹å·²ç»è¢«é€‰æ‹©çš„ç‰¹å¾è¿›è¡Œç­›é€‰ï¼›å¦å¤–ä¸€ä¸ªå¯¹è¢«å‰”é™¤çš„æ¨¡å‹è¿›è¡Œç­›é€‰ï¼Œç„¶åä¸€ç›´é‡å¤è¿™ä¸ªæ­¥éª¤ï¼Œç›´åˆ°è¾¾åˆ°æˆ‘ä»¬æŒ‡å®šçš„ç‰¹å¾æ•°é‡ï¼Œéœ€è¦æ¨¡å‹ä¸­æœ‰ ``feature_importances_`` or `coef_`å±æ€§

```python
rfe = RFE(
    estimator=RandomForestClassifier(n_estimators=100, random_state=30),
    n_features_to_select=6
    )
rfe.fit(X_train_scale, y_train)
X_train_rfe = rfe.transform(X_train_scale)
print(X_train_rfe.shape)
np.array(f_name)[rfe.get_support()] # ç»“æœä¸å‰é¢çš„ä¸€æ ·

```

![image-20240701160408761](https://51catgithubio.oss-cn-beijing.aliyuncs.com/image-20240701160408761.png)

æœ¬æ¬¡æµ‹è¯•çš„æ¨¡å‹å¤ªå°ï¼Œæ‰€ä»¥æ•ˆæœä¸€èˆ¬ï¼Œæ˜ç™½æ–¹æ³•å°±å¥½...
