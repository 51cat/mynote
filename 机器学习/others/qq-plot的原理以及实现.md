# 正态分布检验

## 正态分位图

正态分位图是检验数据是否是正态分布的一种手段, 实际是看理论Z-score和实际Z-score的关系是否为线性关系，是一种比较直观的手段

其原理是：

例如给了9个数据，假设他们来自正态分布的整体，最理想的情况下（理论情况下）抽样得到的9个点会将正态分布按照其累积概率进行10等分，获得如下图所示的分布情况，各个颜色块的面积是相等的。（这9个将概率分布平均分为10份的点，称之为十分位数，第一个点为第一十分位数，第二个为第二十分位数，以此类推），通过计算这个9个值的理论z-score和实际的z-score就能得出我们的数据是否符合正态分布

<img src="https://51catgithubio.oss-cn-beijing.aliyuncs.com/202406231037246.png" alt="img" style="zoom: 67%;" />

理论上的计算方法为：


$$
p=\frac{k}{n+1}
$$
k：从小到大排序后每个元素的秩次

n: 总元素个数

但是由于正态分布的每个区域实际被抽到的概率不一致所以公式按照下面的来调整每个点的概率
$$
\frac{k-a}{n+1-2a}
$$
a: 概率调整值

通过上述公式计算出每个点的累积概率，然后通过Excel或者R的函数就能计算出每个点的理论Z值，同时根据原始数据也能计算出实际的Z值，计算出这些值后就能进行qqplot的绘制了

## 举例

给定一组数据, 通过qqplot判定是否符合正态分布

```
20,16,25,10,30
```

首先计算这组数据的均值和标准差

均值：20.2

标准差：7.759

对数据排序后根据上面的公式计算得到下面的表

理论值：**均值+均值*理论z值**

理论Z值计算：NORM.S.INV函数

CDF:以分位数为2的计算：
$$
\frac{2-0.3}{5+1-0.3*2}
$$


| 分位数 | CDF         | 理论z值  | 理论值   | 实际值 | 实际Z值  |
| ------ | ----------- | -------- | -------- | ------ | -------- |
| 1      | 0.12962963  | -1.12814 | 11.44688 | 10     | -1.31463 |
| 2      | 0.314814815 | -0.48225 | 16.4583  | 16     | -0.54132 |
| 3      | 0.5         | 0        | 20.2     | 10     | -1.31463 |
| 4      | 0.685185185 | 0.482248 | 23.9417  | 15     | -0.6702  |
| 5      | 0.87037037  | 1.128144 | 28.95312 | 30     | 1.263071 |

简单绘制一下：

<img src="https://51catgithubio.oss-cn-beijing.aliyuncs.com/202406231051681.png" alt="image-20240623105144634" style="zoom:67%;" />

R语言实现：

```r
> a <- qqnorm(c(10,16,20,25,30))
> a
$x
[1] -1.1797611 -0.4972006  0.0000000  0.4972006  1.1797611 # 理论Z值和excel的基本一致, 差异可能是a值取值不同

$y
[1] 10 16 20 25 30

> qqline(c(10,16,20,25,30)) # 简单绘制QQ图, car包里面的qqPlot() 也可以 更加美观
```

<img src="https://51catgithubio.oss-cn-beijing.aliyuncs.com/202406231101600.png" alt="image-20240623110100578" style="zoom: 67%;" />
